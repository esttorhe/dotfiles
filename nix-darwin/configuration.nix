{ lib, config, pkgs, ... }:
{
  # Make sure the nix daemon always runs
  services.nix-daemon.enable = true;
  nixpkgs.config.allowUnsupportedSystem = true;
  nixpkgs.config.allowUnfreePredicate = pkg: builtins.elem (lib.getName pkg) [
    "discord"
    "spotify"
    "obsidian"
    "slack"
    "rescuetime"
    "vscode"
  ];

  imports = [ ./system.nix ];

  homebrew = {
    enable = true;
    onActivation.upgrade = true; 
    onActivation.autoUpdate = true;
    casks = [
      "amethyst"
      "1password-cli"
      "anki"
      "arq"
      "daisydisk"
      "imageoptim"
      "keybase"
      "kindle"
      "monitorcontrol"
      "notion"
      "proxyman"
      "rescuetime"
      "selfcontrol"
      "sequel-pro"
      "teensy"
      "wkhtmltopdf"
    ];

    brews = [
      "adns"
      "brotli"
      "giflib"
      "libpng"
      "xz"
      "zstd"
      "libtiff"
      "little-cms2"
      "openexr"
      "webp"
      "aom"
      "autoconf"
      "automake"
      "aws-iam-authenticator"
      "openssl@1.1"
      "readline"
      "sqlite"
      "python@3.11"
      "awscli"
      "bdw-gc"
      "berkeley-db"
      "c-ares"
      "freetype"
      "fontconfig"
      "glib"
      "lzo"
      "pixman"
      "cairo"
      "cmake"
      "gmp"
      "coreutils"
      "cscope"
      "libunistring"
      "libidn2"
      "libssh2"
      "rtmpdump"
      "curl"
      "libusb"
      "dfu-util"
      "diff-so-fancy"
      "doctl"
      "libogg"
      "flac"
      "frei0r"
      "fribidi"
      "libevent"
      "libtasn1"
      "nettle"
      "pam-reattach"
      "p11-kit"
      "unbound"
      "gnutls"
      "graphite2"
      "icu4c"
      "harfbuzz"
      "lame"
      "openjpeg"
      "leptonica"
      "libass"
      "libbluray"
      "libsamplerate"
      "libvorbis"
      "opus"
      "libsndfile"
      "libsoxr"
      "libvidstab"
      "libvpx"
      "opencore-amr"
      "rav1e"
      "rubberband"
      "sdl2"
      "snappy"
      "speex"
      "srt"
      "tesseract"
      "theora"
      "x264"
      "x265"
      "xvid"
      "ffmpeg"
      "fzf"
      "isl"
      "mpfr"
      "libmpc"
      "gcc"
      "gdbm"
      "ghostscript"
      "libde265"
      "shared-mime-info"
      "libheif"
      "liblqr"
      "libomp"
      "libtool"
      "imagemagick"
      {
        name = "openssl@3"; 
        link = true;
      }
      "git-delta"
      "libgpg-error"
      "libassuan"
      "libgcrypt"
      "libksba"
      "npth"
      "pinentry"
      "gnupg"
      "gpgme"
      "gmime"
      "gnu-getopt"
      "gnu-sed"
      "pkg-config"
      "gobject-introspection"
      "guile"
      "ncurses"
      "ilmbase"
      "ipmitool"
      "isync"
      "jansson"
      "jemalloc"
      "jpeg"
      "oniguruma"
      "k9s"
      "krb5"
      "kubernetes-cli"
      "lcov"
      "ldns"
      "libcbor"
      "libev"
      "libffi"
      "libfido2"
      "libmetalink"
      "libvo-aacenc"
      "libyaml"
      "libzip"
      "make"
      "mas"
      "tokyo-cabinet"
      "zlib"
      "ncdu"
      "nghttp2"
      "talloc"
      "xapian"
      "notmuch"
      "openssh"
      "packer"
      "pcre"
      "pdsh"
      "s3cmd"
      "shellcheck"
      "tfenv"
      "the_silver_searcher"
      "thefuck"
      "tig"
      "tldr"
      "utf8proc"
      "trash-cli"
      "tree"
      "unixodbc"
      "urlview"
      "wtfutil"
      "xmlto"
      "z"
    ];
  };
}
