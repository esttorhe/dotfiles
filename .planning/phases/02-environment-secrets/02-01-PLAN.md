---
phase: 02-environment-secrets
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dot_config/private_fish/config.fish.tmpl
autonomous: true

must_haves:
  truths:
    - "PATH includes ~/.local/bin and ~/.bin"
    - "PATH includes cargo and go paths"
    - "EDITOR is set to vi"
    - "LANG and LC_ALL are set to en_US.UTF-8"
    - "Homebrew paths present on macOS only"
    - "Linuxbrew paths present on Linux only"
    - "Tool-specific variables set (GOPATH, PYENV_ROOT, etc.)"
  artifacts:
    - path: "dot_config/private_fish/config.fish.tmpl"
      provides: "PATH and environment variable configuration"
      contains: "set -gx EDITOR"
  key_links:
    - from: "config.fish.tmpl"
      to: "chezmoi template"
      via: "OS detection conditionals"
      pattern: 'if eq .chezmoi.os "darwin"'
---

<objective>
Add PATH configuration and environment variables to fish config

Purpose: Set up all PATH entries and environment variables from existing zsh config, converted to fish syntax
Output: Working environment variables accessible in fish shell
</objective>

<execution_context>
@/Users/esteban.torres/.claude/get-shit-done/workflows/execute-plan.md
@/Users/esteban.torres/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@dot_config/private_fish/config.fish.tmpl
@dot_zsh/_variables.zsh.tmpl
@dot_zsh/_config.zsh.tmpl
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add core environment variables</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add core environment variables under the "Environment variables (Phase 2)" section.

Fish syntax uses `set -gx VAR value` instead of `export VAR=value`.
- `-g` = global scope
- `-x` = export to child processes

Variables to add:
```fish
# Core environment
set -gx EDITOR vi
set -gx LANG en_US.UTF-8
set -gx LC_ALL en_US.UTF-8
set -gx TERM xterm-256color

# Go configuration
set -gx GOPATH ~/workspace
set -gx GO111MODULE on

# Docker settings
set -gx CRUN_NFS 1
set -gx DOCKER_ENABLE_DEPRECATED_PULL_SCHEMA_1_IMAGE true

# Tool configurations
set -gx RIPGREP_CONFIG_PATH "$HOME/.config/ripgreprc"
set -gx GPG_TTY (tty)

# Homebrew (macOS only)
{{ if eq .chezmoi.os "darwin" }}
set -gx HOMEBREW_EDITOR vi
set -gx HOMEBREW_CASK_OPTS "--appdir=/Applications"
{{ end }}

# pyenv
set -gx PYENV_ROOT "$HOME/.pyenv"

# Android SDK (macOS only - standard location)
{{ if eq .chezmoi.os "darwin" }}
set -gx ANDROID_HOME "$HOME/Library/Android/sdk"
{{ end }}

# pnpm
{{ if eq .chezmoi.os "darwin" }}
set -gx PNPM_HOME "/Users/esteban.torres/Library/pnpm"
{{ else }}
set -gx PNPM_HOME "$HOME/.local/share/pnpm"
{{ end }}

# bun
set -gx BUN_INSTALL "$HOME/.bun"

# NVM
set -gx NVM_DIR "$HOME/.nvm"

# SDKMAN
set -gx SDKMAN_DIR "$HOME/.sdkman"
```

Note: GPG_TTY uses `(tty)` which is fish's command substitution syntax (not $(tty)).
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` to verify template syntax is valid.
Check output contains `set -gx EDITOR vi` and other variables.
  </verify>
  <done>Core environment variables added with correct fish syntax and chezmoi templating</done>
</task>

<task type="auto">
  <name>Task 2: Add PATH configuration</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add PATH configuration after the environment variables.

Fish provides `fish_add_path` which is cleaner than manually manipulating PATH:
- `fish_add_path /path` adds to front of PATH
- Automatically handles duplicates
- Persists properly

However, for chezmoi templates we can also use `set -gxp PATH /path` to prepend.

Add PATH entries (use fish_add_path for cleanliness):
```fish
# ============================================
# PATH configuration
# ============================================

# User bin directories (highest priority)
fish_add_path -g "$HOME/.local/bin"
fish_add_path -g "$HOME/.bin"

# Homebrew (macOS)
{{ if eq .chezmoi.os "darwin" }}
fish_add_path -g /opt/homebrew/bin
fish_add_path -g /opt/homebrew/sbin
{{ end }}

# Linuxbrew (Linux)
{{ if eq .chezmoi.os "linux" }}
fish_add_path -g /home/linuxbrew/.linuxbrew/bin
fish_add_path -g /home/linuxbrew/.linuxbrew/sbin
{{ end }}

# Cargo (Rust)
fish_add_path -g "$HOME/.cargo/bin"

# Go
fish_add_path -g "$GOPATH/bin"
{{ if eq .chezmoi.os "linux" }}
fish_add_path -g /usr/local/go/bin
{{ end }}

# pyenv
if test -d "$PYENV_ROOT/bin"
    fish_add_path -g "$PYENV_ROOT/bin"
end

# pnpm
fish_add_path -g "$PNPM_HOME"

# bun
fish_add_path -g "$BUN_INSTALL/bin"

# Docker
fish_add_path -g "$HOME/.docker/bin"

# Android SDK (macOS)
{{ if eq .chezmoi.os "darwin" }}
fish_add_path -g "$ANDROID_HOME/platform-tools"
fish_add_path -g "$ANDROID_HOME/tools"
{{ end }}

# npm global
fish_add_path -g (npm prefix -g)/bin 2>/dev/null

# System paths
fish_add_path -g /usr/local/bin
fish_add_path -g /usr/local/sbin
```

Note: `-g` flag makes path global. The `2>/dev/null` suppresses errors if npm not installed.
Note: fish_add_path handles duplicates and non-existent paths gracefully.
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` - should produce valid fish config.
Run `chezmoi apply --dry-run` - should show no errors.
  </verify>
  <done>PATH configuration added with OS-specific paths and fish-native syntax</done>
</task>

<task type="auto">
  <name>Task 3: Apply and verify environment</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Apply the chezmoi config and verify in fish shell.

1. Run `chezmoi apply` to deploy the updated config
2. Start a new fish shell or run `source ~/.config/fish/config.fish`
3. Verify key variables are set

Verification commands to run in fish:
```fish
echo $EDITOR        # Should output: vi
echo $LANG          # Should output: en_US.UTF-8
echo $GOPATH        # Should output: ~/workspace (expanded)
echo $PATH | tr ' ' '\n' | head -10  # Should show priority paths
```
  </action>
  <verify>
Run verification commands in fish shell:
- `fish -c 'echo $EDITOR'` returns "vi"
- `fish -c 'echo $LANG'` returns "en_US.UTF-8"
- `fish -c 'echo $PATH'` includes ~/.local/bin and ~/.cargo/bin
  </verify>
  <done>Environment variables and PATH verified working in fish shell</done>
</task>

</tasks>

<verification>
After all tasks:
1. `chezmoi apply` completes without errors
2. `fish -c 'echo $EDITOR'` outputs "vi"
3. `fish -c 'echo $LANG'` outputs "en_US.UTF-8"
4. `fish -c 'echo $GOPATH'` outputs home directory path/workspace
5. `fish -c 'string match -q "*/.local/bin*" $PATH; and echo found'` outputs "found"
6. `fish -c 'string match -q "*/.cargo/bin*" $PATH; and echo found'` outputs "found"
7. On macOS: `fish -c 'string match -q "*/opt/homebrew/bin*" $PATH; and echo found'` outputs "found"
</verification>

<success_criteria>
- All environment variables from zsh config converted to fish syntax
- PATH includes all required directories in correct order
- OS-specific paths load only on correct OS
- Fish shell starts without errors after chezmoi apply
- Variables accessible in new fish sessions
</success_criteria>

<output>
After completion, create `.planning/phases/02-environment-secrets/02-01-SUMMARY.md`
</output>
