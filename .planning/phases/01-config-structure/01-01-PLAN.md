---
phase: 01-config-structure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dot_config/private_fish/config.fish.tmpl
autonomous: false

must_haves:
  truths:
    - "dot_config/private_fish/ directory exists in chezmoi repo"
    - "config.fish.tmpl contains chezmoi template markers"
    - "chezmoi apply creates ~/.config/fish/config.fish"
    - "fish shell starts without syntax errors"
  artifacts:
    - path: "dot_config/private_fish/config.fish.tmpl"
      provides: "Fish shell entry point with chezmoi templating"
      min_lines: 15
      contains: "chezmoi"
  key_links:
    - from: "dot_config/private_fish/config.fish.tmpl"
      to: "~/.config/fish/config.fish"
      via: "chezmoi apply"
      pattern: "chezmoi:template"
---

<objective>
Create the fish shell configuration file structure within chezmoi, establishing the foundation for all subsequent fish configuration work.

Purpose: This is the base layer - without the config.fish file in the right location, no other fish configuration can work. Using `private_fish` ensures chezmoi sets restrictive permissions (0700 for directory, 0600 for files) which is appropriate for shell configs that may contain secrets.

Output: A working `config.fish.tmpl` that chezmoi can apply to create `~/.config/fish/config.fish`, with fish starting cleanly.
</objective>

<execution_context>
@/Users/esteban.torres/.claude/get-shit-done/workflows/execute-plan.md
@/Users/esteban.torres/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference existing chezmoi patterns
@dot_zshrc.tmpl
@dot_zsh/_variables.zsh.tmpl
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create fish config directory and base template</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Create the directory `dot_config/private_fish/` and create `config.fish.tmpl` with:

1. Chezmoi template header comment at the top (identifies it as a managed file)
2. Basic fish config structure with sections for:
   - Interactive shell guard (only run for interactive sessions)
   - Placeholder section comments for future phases (PATH, environment, tools, abbreviations)
3. OS detection variable using chezmoi template: `set -l os "{{ .chezmoi.os }}"`

The file should be minimal but complete enough that fish starts without errors.

**Template structure:**
```fish
# ABOUTME: Fish shell configuration managed by chezmoi
# ABOUTME: Main entry point - sources environment, tools, and abbreviations

# chezmoi:template:left-delimiter="{{" right-delimiter="}}"

# Only run in interactive mode
status is-interactive; or exit

# OS detection for conditional config
set -l os "{{ .chezmoi.os }}"

# ============================================
# Environment variables (Phase 2)
# ============================================

# ============================================
# Tool integrations (Phase 3)
# ============================================

# ============================================
# Abbreviations (Phase 4)
# ============================================
```

**Important:** Use `private_fish` prefix (not just `fish`) so chezmoi applies restrictive permissions matching the existing `private_1Password` pattern.
  </action>
  <verify>
Run: `ls -la dot_config/private_fish/` to confirm directory exists
Run: `cat dot_config/private_fish/config.fish.tmpl` to verify template content
Run: `chezmoi diff` to see what would be applied
  </verify>
  <done>
- Directory `dot_config/private_fish/` exists
- File `config.fish.tmpl` exists with chezmoi template markers
- File contains valid fish syntax (section comments, status check)
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply config and verify fish shell starts</name>
  <files>~/.config/fish/config.fish</files>
  <action>
Run chezmoi apply to deploy the fish config, then verify fish starts cleanly:

1. Run `chezmoi apply -v` to apply the template (verbose to see what happens)
2. Verify the target file exists at `~/.config/fish/config.fish`
3. Check file permissions (should be 0600 due to private_ prefix)
4. Launch fish in a subshell to verify it starts without syntax errors: `fish -c "echo 'Fish started successfully'"
5. Verify the config loads by checking fish can read its own config: `fish -c "status is-interactive && echo 'Interactive mode works'"`

**Expected outcome:** Fish shell starts, prints the test messages, and exits cleanly with code 0.
  </action>
  <verify>
Run: `ls -la ~/.config/fish/config.fish` - file exists with restrictive permissions
Run: `fish -c "echo 'Fish OK'; exit 0"` - exits with code 0, prints "Fish OK"
  </verify>
  <done>
- `~/.config/fish/config.fish` exists and is readable
- File permissions are 0600 (or close - chezmoi private_ behavior)
- `fish -c "echo test"` succeeds without syntax errors
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fish shell config directory structure and base config.fish template with chezmoi integration</what-built>
  <how-to-verify>
1. Open a new terminal tab/window
2. Run: `fish` to start fish shell interactively
3. You should see your regular prompt (starship should work since it's already configured)
4. Type: `echo $status` - should show 0 (no errors during startup)
5. Type: `exit` to return to your previous shell
6. Confirm the config file exists: `cat ~/.config/fish/config.fish`
  </how-to-verify>
  <resume-signal>Type "approved" if fish starts cleanly, or describe any errors you see</resume-signal>
</task>

</tasks>

<verification>
Phase 1 verification checklist:
- [ ] `dot_config/private_fish/` directory exists in chezmoi repo
- [ ] `config.fish.tmpl` contains chezmoi template markers
- [ ] `chezmoi apply` runs without errors
- [ ] `~/.config/fish/config.fish` is created with correct permissions
- [ ] `fish` shell starts without syntax errors
- [ ] User has manually verified interactive fish session works
</verification>

<success_criteria>
1. CONF-01 satisfied: `dot_config/private_fish/` directory structure exists
2. CONF-02 satisfied: `config.fish.tmpl` created as main entry point with chezmoi templating
3. Fish shell launches cleanly with no errors
4. File permissions are restrictive (private_ prefix honored by chezmoi)
</success_criteria>

<output>
After completion, create `.planning/phases/01-config-structure/01-01-SUMMARY.md`
</output>
