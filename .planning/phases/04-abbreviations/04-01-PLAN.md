---
phase: 04-abbreviations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dot_config/private_fish/config.fish.tmpl
autonomous: true

must_haves:
  truths:
    - "vim and vi expand to nvim"
    - "Git abbreviations work (gst, ga, gb, gp, gco, gd, etc.)"
    - "Tool abbreviations work (la, cat, lg, ld)"
    - "OS-specific abbreviations load conditionally"
    - "Docker abbreviations work (dls, drm)"
    - "Chezmoi abbreviations work (chema, cmm)"
  artifacts:
    - path: "dot_config/private_fish/config.fish.tmpl"
      provides: "Fish abbreviations"
      contains: "abbr -a"
  key_links:
    - from: "config.fish.tmpl"
      to: "abbreviations"
      via: "abbr command"
      pattern: "abbr -a gst"
---

<objective>
Convert zsh aliases to fish abbreviations

Purpose: Provide familiar shortcuts that expand to full commands (visible in history)
Output: All common aliases from zsh config working as fish abbreviations
</objective>

<execution_context>
@/Users/esteban.torres/.claude/get-shit-done/workflows/execute-plan.md
@/Users/esteban.torres/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@dot_config/private_fish/config.fish.tmpl
@dot_zsh/aliases.zsh.tmpl
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add core editor abbreviations (ABBR-01)</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add core editor abbreviations under the "Abbreviations (Phase 4)" section.

Fish abbreviations expand as you type, showing the full command in the prompt and history.

```fish
# ============================================
# Abbreviations (Phase 4)
# ============================================

# Editor abbreviations
abbr -a vim nvim
abbr -a vi nvim
```

Notes:
- `abbr -a name command` adds an abbreviation
- When you type `vim` and press space/enter, it expands to `nvim`
- History shows `nvim`, not `vim` (unlike aliases)
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` and verify:
- Output contains `abbr -a vim nvim`
- Output contains `abbr -a vi nvim`
  </verify>
  <done>Editor abbreviations vim/vi → nvim added</done>
</task>

<task type="auto">
  <name>Task 2: Add Git abbreviations (ABBR-02)</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add Git abbreviations after editor abbreviations.

```fish
# Git abbreviations
abbr -a gst 'git status'
abbr -a ga 'git add'
abbr -a gb 'git branch'
abbr -a gp 'git push'
abbr -a gcmsg 'git commit -m'
abbr -a grbi 'git rebase -i'
abbr -a grbc 'git rebase --continue'
abbr -a grba 'git rebase --abort'
abbr -a gc 'git commit'
abbr -a gd 'git diff'
abbr -a gco 'git checkout'
abbr -a gca 'git commit --amend'
```

Notes:
- Commands with spaces/flags need single quotes
- `gc` for commit, `gca` for amend (not duplicating `gc` like in zsh aliases)
- `gumain` omitted as it references `git pufo` which may not exist
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` and verify:
- Output contains `abbr -a gst 'git status'`
- Output contains `abbr -a gco 'git checkout'`
  </verify>
  <done>Git abbreviations added</done>
</task>

<task type="auto">
  <name>Task 3: Add tool abbreviations (ABBR-03)</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add tool abbreviations after Git abbreviations.

```fish
# Tool abbreviations
abbr -a la 'eza -abghHliS --git --icons'
abbr -a cat bat
abbr -a lg lazygit
abbr -a ld lazydocker
abbr -a be 'bundle exec'
abbr -a gotr 'go test -run'
```

Notes:
- `la` expands to full eza command with all flags
- `cat` → `bat` for syntax-highlighted file viewing
- `lg` → `lazygit`, `ld` → `lazydocker`
- `be` → `bundle exec` for Ruby
- `gotr` → `go test -run` for Go testing
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` and verify:
- Output contains `abbr -a la 'eza -abghHliS --git --icons'`
- Output contains `abbr -a cat bat`
- Output contains `abbr -a lg lazygit`
  </verify>
  <done>Tool abbreviations added</done>
</task>

<task type="auto">
  <name>Task 4: Add OS-specific abbreviations (ABBR-04)</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add OS-specific abbreviations using chezmoi conditionals.

```fish
# OS-specific abbreviations
{{ if eq .chezmoi.os "darwin" }}
# macOS: use trash instead of rm for safety
abbr -a rm trash
# macOS: flush DNS cache
abbr -a flushcache 'sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder'
# macOS: update everything
abbr -a update 'brew update && brew upgrade && brew upgrade --cask && brew cleanup -s && mas upgrade && mise upgrade --bump && mise self-update'
{{ else if eq .chezmoi.os "linux" }}
{{ if eq .chezmoi.osRelease.id "arch" }}
abbr -a update 'sudo omarchy-update'
{{ else if eq .chezmoi.osRelease.id "debian" }}
abbr -a update 'sudo apt update && sudo apt upgrade --fix-missing --fix-broken && sudo apt autoclean && sudo apt autoremove && sudo snap refresh && sudo restic self-update'
{{ end }}
# Linux: pbcopy equivalent
abbr -a pbcopy 'xclip -selection clipboard'
{{ end }}
```

Notes:
- macOS uses `trash` command for safe deletion
- Update commands are OS/distro specific
- Linux gets pbcopy alias to xclip
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` on macOS and verify:
- Output contains `abbr -a rm trash`
- Output contains `abbr -a update 'brew update`
- Linux conditionals are not rendered on macOS
  </verify>
  <done>OS-specific abbreviations added with chezmoi conditionals</done>
</task>

<task type="auto">
  <name>Task 5: Add Docker abbreviations (ABBR-05)</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add Docker abbreviations after OS-specific section.

```fish
# Docker abbreviations
abbr -a dls 'docker ps'
abbr -a drm 'docker rm -f'
```

Notes:
- `dls` → `docker ps` to list containers
- `drm` → `docker rm -f` to force remove containers
- `dockrun` omitted as it's complex and better as a function
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` and verify:
- Output contains `abbr -a dls 'docker ps'`
- Output contains `abbr -a drm 'docker rm -f'`
  </verify>
  <done>Docker abbreviations added</done>
</task>

<task type="auto">
  <name>Task 6: Add Chezmoi and misc abbreviations (ABBR-06)</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add Chezmoi and miscellaneous abbreviations.

```fish
# Chezmoi abbreviations
abbr -a chema 'chezmoi apply'
abbr -a cmm "chezmoi diff -f git | grep -- ^--- | sed -e 's/^--- a\///' | xargs -r chezmoi merge"

# Misc abbreviations
abbr -a zsource 'source ~/.config/fish/config.fish'
abbr -a claudio 'claude --dangerously-skip-permissions'
```

Notes:
- `chema` → apply chezmoi changes
- `cmm` → merge chezmoi conflicts (complex pipeline)
- `zsource` updated for fish config location
- `claudio` for Claude CLI with permissions skip
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` and verify:
- Output contains `abbr -a chema 'chezmoi apply'`
- Output contains `abbr -a zsource`
  </verify>
  <done>Chezmoi and misc abbreviations added</done>
</task>

<task type="auto">
  <name>Task 7: Apply and verify abbreviations</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Apply the config and verify abbreviations work in fish.

1. Run `chezmoi apply` to deploy the updated config

2. Test abbreviations in fish shell:
```fish
# Test that abbreviations are defined
abbr --show | grep gst
abbr --show | grep vim
abbr --show | grep la

# Test expansion (type and press space)
# vim → nvim
# gst → git status
# la → eza -abghHliS --git --icons
```

3. Verify fish shell starts without errors
  </action>
  <verify>
Verification commands:
- `chezmoi apply` completes without errors
- `fish -c 'abbr --show' | grep -c abbr` shows count of abbreviations
- `fish -c 'abbr --show | grep gst'` shows git status abbreviation
- `fish -c 'abbr --show | grep vim'` shows nvim abbreviation
- Fish shell starts without errors
  </verify>
  <done>All abbreviations working in fish shell</done>
</task>

</tasks>

<verification>
After all tasks:
1. `chezmoi apply` completes without errors
2. Fish shell starts without errors
3. `fish -c 'abbr --show | grep vim'` shows vim → nvim
4. `fish -c 'abbr --show | grep gst'` shows gst → git status
5. `fish -c 'abbr --show | grep la'` shows la → eza command
6. `fish -c 'abbr --show | grep lg'` shows lg → lazygit
7. `fish -c 'abbr --show | grep dls'` shows dls → docker ps
8. `fish -c 'abbr --show | grep chema'` shows chema → chezmoi apply
9. On macOS: `fish -c 'abbr --show | grep "rm"'` shows rm → trash
</verification>

<success_criteria>
- All 6 ABBR requirements satisfied
- Abbreviations expand correctly when typed
- OS-specific abbreviations load only on correct OS
- Fish shell starts without errors
- History shows expanded commands (not abbreviation names)
</success_criteria>

<output>
After completion, create `.planning/phases/04-abbreviations/04-01-SUMMARY.md`
</output>
