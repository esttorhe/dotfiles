---
phase: 03-tool-integrations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dot_config/private_fish/config.fish.tmpl
autonomous: true

must_haves:
  truths:
    - "Atuin history search is initialized"
    - "Mise version manager is activated"
    - "fzf keybindings are loaded"
    - "direnv hook is configured"
    - "Tools initialize only when installed (graceful fallback)"
  artifacts:
    - path: "dot_config/private_fish/config.fish.tmpl"
      provides: "Tool initializations"
      contains: "atuin init fish"
    - path: "dot_config/private_fish/config.fish.tmpl"
      provides: "Mise activation"
      contains: "mise activate fish"
  key_links:
    - from: "config.fish.tmpl"
      to: "atuin"
      via: "init command"
      pattern: "atuin init fish | source"
    - from: "config.fish.tmpl"
      to: "mise"
      via: "activate command"
      pattern: "mise activate fish | source"
    - from: "config.fish.tmpl"
      to: "direnv"
      via: "hook command"
      pattern: "direnv hook fish | source"
---

<objective>
Add tool initializations for atuin, mise, fzf, and direnv to fish config

Purpose: Initialize shell tools that enhance the development workflow
Output: Working tool integrations with proper keybindings and functionality
</objective>

<execution_context>
@/Users/esteban.torres/.claude/get-shit-done/workflows/execute-plan.md
@/Users/esteban.torres/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@dot_config/private_fish/config.fish.tmpl
@dot_zshrc.tmpl
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Atuin history initialization</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add Atuin shell history initialization under the "Tool integrations" section.

Atuin replaces the default shell history with a SQLite database that syncs across machines.

Add after the Starship init (which is already there):

```fish
# Atuin shell history
if type -q atuin
    atuin init fish | source
end
```

Notes:
- `type -q atuin` checks if atuin is installed before trying to init
- Atuin will handle Ctrl+R for history search
- The `| source` pipes the init script into the current shell
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` and verify:
- Output contains `atuin init fish | source`
- Conditional check for atuin is present
  </verify>
  <done>Atuin history search initialized with fallback check</done>
</task>

<task type="auto">
  <name>Task 2: Add Mise version manager activation</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add Mise (formerly rtx) version manager activation.

Mise manages tool versions (node, python, ruby, etc.) similar to asdf but faster.

Add after Atuin:

```fish
# Mise version manager
if type -q mise
    mise activate fish | source
end
```

Notes:
- Mise activation sets up shims and automatic version switching
- The zsh config also had `mise activate zsh --shims` but fish handles this differently
- For fish, the standard `mise activate fish | source` is sufficient
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` and verify:
- Output contains `mise activate fish | source`
- Conditional check for mise is present
  </verify>
  <done>Mise version manager activated with fallback check</done>
</task>

<task type="auto">
  <name>Task 3: Add fzf keybindings</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add fzf (fuzzy finder) keybindings for fish.

fzf provides fuzzy finding for files, directories, and command history.

Add after Mise:

```fish
# fzf keybindings
if type -q fzf
    fzf --fish | source
end
```

Notes:
- `fzf --fish` generates fish-specific keybindings (modern fzf approach)
- This provides:
  - Ctrl+T: File search
  - Ctrl+R: History search (may conflict with atuin - atuin takes precedence)
  - Alt+C: Directory search
- Older fzf versions used a separate fish plugin; modern fzf has built-in support
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` and verify:
- Output contains `fzf --fish | source`
- Conditional check for fzf is present
  </verify>
  <done>fzf keybindings loaded with fallback check</done>
</task>

<task type="auto">
  <name>Task 4: Add direnv hook</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Add direnv hook for automatic environment loading.

direnv loads environment variables from `.envrc` files when entering directories.

Add after fzf:

```fish
# direnv
if type -q direnv
    direnv hook fish | source
end
```

Notes:
- direnv hook integrates with fish's prompt/cd to auto-load `.envrc`
- User must run `direnv allow` in directories with `.envrc` files
- This replaces manual `source .envrc` workflows
  </action>
  <verify>
Run `chezmoi execute-template < dot_config/private_fish/config.fish.tmpl` and verify:
- Output contains `direnv hook fish | source`
- Conditional check for direnv is present
  </verify>
  <done>direnv hook configured with fallback check</done>
</task>

<task type="auto">
  <name>Task 5: Apply and verify tool integrations</name>
  <files>dot_config/private_fish/config.fish.tmpl</files>
  <action>
Apply the config and verify all tools work in fish.

1. Run `chezmoi apply` to deploy the updated config

2. Test each tool in fish shell:

```fish
# Test Atuin
atuin search --limit 5  # Should show recent history

# Test Mise
mise current  # Should show active tool versions

# Test fzf
echo "test" | fzf --filter "test"  # Basic fzf test

# Test direnv (if in a directory with .envrc)
direnv status
```

3. Verify keybindings work:
- Ctrl+R should bring up Atuin history search
- Ctrl+T should bring up fzf file finder
  </action>
  <verify>
Verification commands:
- `fish -c 'atuin --version'` returns version (atuin installed)
- `fish -c 'mise --version'` returns version (mise installed)
- `fish -c 'fzf --version'` returns version (fzf installed)
- `fish -c 'direnv --version'` returns version (direnv installed)
- `chezmoi apply` completes without errors
- Fish shell starts without errors
  </verify>
  <done>All tool integrations working in fish shell</done>
</task>

</tasks>

<verification>
After all tasks:
1. `chezmoi apply` completes without errors
2. Fish shell starts without errors
3. `fish -c 'atuin search --limit 1'` works (atuin active)
4. `fish -c 'mise current'` works (mise active)
5. Ctrl+R in fish opens atuin history search
6. Ctrl+T in fish opens fzf file finder
7. direnv auto-loads `.envrc` when entering directories with allowed envrc files
</verification>

<success_criteria>
- All tool initializations added with proper fallback checks
- Tools only initialize when installed (graceful degradation)
- Keybindings work correctly (atuin for Ctrl+R, fzf for Ctrl+T)
- Fish shell starts without errors on systems with/without these tools
- All requirements TOOL-02 through TOOL-05 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-tool-integrations/03-01-SUMMARY.md`
</output>
